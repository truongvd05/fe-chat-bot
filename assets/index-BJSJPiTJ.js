import{a as f,n as v,r,o as b,p as j,q as E,t as y,j as e,M,T as S}from"./index-aeCwJNX1.js";function $(){const p=f(),{conversationId:s}=v(),d=r.useRef(null),{data:x,isLoading:w,error:N}=b(s),{data:n,isLoading:L,error:C}=j(s),[h,{isLoading:k,error:D}]=E(),[l,u]=r.useState(""),m=async()=>{try{await h({conversationId:s,content:l}).unwrap(),u("")}catch(t){console.log("Error:",t)}};return console.log(n),r.useEffect(()=>{d.current?.scrollIntoView({behavior:"smooth"})},[n]),r.useEffect(()=>{const t=localStorage.getItem("access_token");if(!s)return;const a=new EventSource(`http://127.0.0.1:3000/api/conversation/${s}/stream?token=${t}`,{withCredentials:!0});return a.addEventListener("connected",o=>{console.log("SSE connected")}),a.onmessage=o=>{const c=JSON.parse(o.data);c.type==="bot_stream"&&p(y.util.updateQueryData("getMessage",s,i=>{const g=i[i.length-1];g?.role==="bot"?g.content+=c.content:i.push({id:Date.now(),role:"bot",content:c.content})}))},a.onerror=o=>{console.error("SSE error",o),a.close()},()=>{a.close()}},[s]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-2 py-2 flex-1 h-full",children:[e.jsx("p",{className:"text-2xl py-2",children:x?.title}),e.jsx("div",{className:"flex flex-col flex-1 gap-4 pb-30",children:n?.map(t=>e.jsx("div",{className:`${t.role==="user"?"":"border-b border-t"}`,children:e.jsx(M,{message:t,right:t.role==="user",user:t.role==="user"})},t.id))}),e.jsx("div",{ref:d})]}),e.jsxs("div",{className:"sticky bottom-10 w-[80%] mr-auto ml-auto relative",children:[e.jsx(S,{id:"textarea-message",value:l,onChange:t=>{u(t.target.value)},className:"overflow-hidden px-5 h-16 text-lg rounded-3xl",placeholder:"Enter text"}),e.jsx("button",{onClick:m,disabled:!l,className:`p-3 absolute right-5 top-1/2 -translate-y-1/2\r
                disabled:opacity-40\r
                disabled:cursor-not-allowed`,children:e.jsx("i",{className:"fa-regular fa-paper-plane"})})]})]})}export{$ as default};
