import{r as o,u as N,c as b,d as E,e as v,j as e,I as n,B as C,N as _}from"./index-CXSTUKRY.js";import{C as q,a as S,b as M,c as R}from"./card-DpO56Kqh.js";import{u as T,o as I,c as L,a as l,b as $}from"./yup-jtmnGSUG.js";const z=L({username:l().min(3,"tên ít nhất 3 kí tự").required("Tên người dùng là bắt buộc"),email:l().email("Email không hợp lệ").required("Email là bắt buộc"),password:l().min(6,"mật khẩu tối thiểu 6 kí tự").required("Mật khẩu là bắt buộc"),password_confirmation:l().oneOf([$("password")],"Mật khẩu không trùng khớp").required("Nhập lại mật khẩu")});function O(){const{register:r,handleSubmit:x,setError:c,clearErrors:m,watch:h,formState:{errors:s}}=T({resolver:I(z)}),[g,d]=o.useState(!1),f=N(),[w,{isLoading:u,error:B}]=b(),[k,{isLoading:j}]=E(),y=async a=>{try{const t=await w({name:a.username,email:a.email,password:a.password,confirm_password:a.password_confirmation}).unwrap();console.log(t),localStorage.setItem("access_token",t.access_token),localStorage.setItem("refresh_token",t.refresh_token),d(!0),setTimeout(()=>{f("/login")},6e3)}catch(t){c("root",{type:"manual",message:t?.data?.error})}finally{setTimeout(()=>{d(!1)},5e3)}},p=h("email"),i=o.useMemo(()=>v(async a=>{if(a)try{await k({email:a}).unwrap(),m("email")}catch(t){c("email",{type:"manual",message:t.data.error||"email không hợp lệ"})}},800),[m,c]);return o.useEffect(()=>{i(p),m("root")},[p,i]),o.useEffect(()=>()=>{i.cancel()},[i]),e.jsxs(q,{className:"w-full max-w-sm m-auto",children:[e.jsx(S,{children:e.jsx(M,{className:"m-auto",children:"Register"})}),e.jsxs("form",{className:"flex flex-col items-center gap-2",onSubmit:x(y),children:[e.jsxs("div",{className:"flex flex-col w-[80%] m-auto gap-2",children:[e.jsx(n,{type:"text",autoComplete:"username",placeholder:"Tên người dùng",...r("username",{required:!0})}),s.username&&e.jsx("span",{className:"text-red-500 text-sm",children:s.username.message}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{autoComplete:"email",type:"email",placeholder:"Email",...r("email",{required:!0})}),j&&e.jsx("i",{className:"fa-solid fa-spinner absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-gray-400"})]}),s.email&&e.jsx("span",{className:"text-red-500 text-sm",children:s.email.message}),e.jsx(n,{type:"password",autoComplete:"new-password",placeholder:"Mật khẩu",...r("password",{required:!0})}),s.password&&e.jsx("span",{className:"text-red-500 text-sm",children:s.password.message}),e.jsx(n,{type:"password",autoComplete:"new-password",placeholder:"Xác nhận mật khẩu",...r("password_confirmation",{required:!0})}),s.password_confirmation&&e.jsx("span",{className:"text-red-500 text-sm",children:s.password_confirmation.message})]}),s.root&&e.jsx("p",{className:"text-red-500",children:s.root.message||"Đã có lỗi xảy ra"}),u&&e.jsx("i",{className:"fa-solid fa-spinner animate-spin text-gray-400"}),e.jsx(C,{disabled:u,className:"block",type:"submit",children:"Đăng kí"})]}),e.jsx(R,{className:" flex flex-col",children:e.jsx(_,{className:"",to:"/login",children:"Đã có tài khoản"})}),e.jsx("div",{className:`
                    fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2
                    text-center rounded-2xl px-6 py-4
                    bg-popover text-green-600
                    transition-all duration-200
                    border
                    ${g?"opacity-100 scale-100 z-50":"opacity-0 scale-90 pointer-events-none -z-10"}
                `,children:"Chúng tôi đã gửi một liên kết xác thực tới email của bạn. Vui lòng kiểm tra email để xác thực tài khoản"})]})}export{O as default};
