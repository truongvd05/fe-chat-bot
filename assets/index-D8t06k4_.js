import{j as e,n as f,p as v,a as w,q as j,r as l,t as y,v as E,w as N,x as S}from"./index-DHPJwz_M.js";function M({className:a,...t}){return e.jsx("textarea",{"data-slot":"textarea",className:f("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...t})}function k({message:a,right:t,key:o}){const{theme:n,setTheme:m}=v();return e.jsx("div",{className:`
        ${t?"flex justify-end ml-auto":""} 
        w-[80%] whitespace-pre-wrap break-words
        `,children:e.jsx("p",{className:`
                ${t&&n==="light"?"bg-olive-100 ":""}
                ${t?"border border-white":""}
                px-2 py-3 rounded-2xl
                `,children:a.content})},o)}function I(){const a=w(),{conversationId:t}=j(),o=l.useRef(null),{data:n,isLoading:m,error:L}=y(t),{data:p,isLoading:$,error:C}=E(t),[h,{isLoading:D,error:B}]=N(),[c,x]=l.useState(""),b=async()=>{try{n.type==="BOT"&&await h({conversationId:t,content:c}).unwrap(),x("")}catch(s){console.log("Error:",s)}};return l.useEffect(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[p]),l.useEffect(()=>{const s=localStorage.getItem("access_token");if(!t)return;const r=new EventSource(`http://127.0.0.1:3000/api/conversation/${t}/stream?token=${s}`,{withCredentials:!0});return r.addEventListener("connected",i=>{console.log("SSE connected")}),r.onmessage=i=>{const d=JSON.parse(i.data);d.type==="bot_stream"&&a(S.util.updateQueryData("getMessage",t,u=>{const g=u[u.length-1];g?.role==="bot"?g.content+=d.content:u.push({id:Date.now(),role:"bot",content:d.content})}))},r.onerror=i=>{console.error("SSE error",i),r.close()},()=>{r.close()}},[t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-2 py-2 flex-1 h-full",children:[e.jsx("p",{className:"text-2xl py-2",children:n?.title}),e.jsx("div",{className:"flex flex-col flex-1 gap-4 pb-30",children:p?.map(s=>e.jsx("div",{ref:o,className:`${s.role==="user"?"":"border-b border-t"}`,children:e.jsx(k,{message:s,right:s.role==="user"})},s.id))})]}),e.jsxs("div",{className:"sticky bottom-10 w-[80%] mr-auto ml-auto relative",children:[e.jsx(M,{id:"textarea-message",value:c,onChange:s=>{x(s.target.value)},className:"overflow-hidden px-5 h-16 text-lg rounded-3xl",placeholder:"Enter text"}),e.jsx("button",{onClick:b,disabled:!c,className:`p-3 absolute right-5 top-1/2 -translate-y-1/2\r
                disabled:opacity-40\r
                disabled:cursor-not-allowed`,children:e.jsx("i",{className:"fa-regular fa-paper-plane"})})]})]})}export{I as default};
